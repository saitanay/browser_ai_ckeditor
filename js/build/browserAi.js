!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.browserAi=t())}(self,()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";r.d(i,{default:()=>d});var e=r("ckeditor5/src/core.js"),t=r("ckeditor5/src/ui.js"),o=r("ckeditor5/src/utils.js");class n extends t.View{constructor(e){super(e);const t=e.t;this.focusTracker=new o.FocusTracker,this.keystrokes=new o.KeystrokeHandler,this.topicInputView=this._createInput(t("Topic or prompt")),this.submitButtonView=this._createButton(t("Generate"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.972 16.615a.997.997 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.414L7.716 16.323a.997.997 0 0 1-.744.292z"/></svg>',"ck-button-save"),this.submitButtonView.type="submit",this.cancelButtonView=this._createButton(t("Cancel"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.591 10.177 4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242-4.243-4.243a1 1 0 0 1 1.414-1.414l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414l-4.243 4.243z"/></svg>',"ck-button-cancel"),this.cancelButtonView.delegate("execute").to(this,"cancel"),this.setTemplate({tag:"form",attributes:{class:["ck","ck-browser-ai-form"],tabindex:"-1"},children:[this.topicInputView,this._createActionsView()]})}render(){super.render(),(0,t.submitHandler)({view:this}),[this.topicInputView,this.submitButtonView,this.cancelButtonView].forEach(e=>{this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.topicInputView.focus()}_createInput(e){const r=new t.LabeledFieldView(this.locale,t.createLabeledInputText);return r.label=e,r.fieldView.placeholder=Drupal.t("Enter a topic to write about..."),r}_createButton(e,r,i){const o=new t.ButtonView(this.locale);return o.set({label:e,icon:r,tooltip:!0,class:i}),o}_createActionsView(){const e=new t.View(this.locale);return e.setTemplate({tag:"div",attributes:{class:["ck","ck-browser-ai-form__actions"]},children:[this.cancelButtonView,this.submitButtonView]}),e}}function s(e){if(!e.element)return;const t=e.element.querySelector(".ck-icon");t&&(e._originalIconHTML=t.innerHTML,t.innerHTML='<svg class="ck-browser-ai-spinner" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="25 75" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 10 10" to="360 10 10" dur="0.8s" repeatCount="indefinite"/></circle></svg>',t.style.animation="none"),e.element.style.opacity="0.7",e.element.style.pointerEvents="none"}function a(e){if(!e.element)return;const t=e.element.querySelector(".ck-icon");t&&e._originalIconHTML&&(t.innerHTML=e._originalIconHTML,t.style.animation=""),e.element.style.opacity="",e.element.style.pointerEvents=""}class l extends e.Plugin{static get requires(){return[t.ContextualBalloon]}static get pluginName(){return"BrowserAiUI"}init(){const e=this.editor;this._balloon=e.plugins.get(t.ContextualBalloon),this._formView=this._createFormView(),this._registerButton("aiRewrite","Rewrite",'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n  <path fill="currentColor" d="M15.5 2.5a2.121 2.121 0 0 1 3 3L7.5 16.5l-4 1 1-4L15.5 2.5z"/>\n  <path d="M2 18h16" stroke="currentColor" stroke-width="1.5" fill="none"/>\n</svg>\n'),this._registerButton("aiSummarize","Summarize",'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n  <rect fill="currentColor" x="2" y="3" width="16" height="2" rx="0.5"/>\n  <rect fill="currentColor" x="2" y="7" width="16" height="2" rx="0.5"/>\n  <rect fill="currentColor" x="2" y="11" width="10" height="2" rx="0.5"/>\n  <rect fill="currentColor" x="2" y="15" width="6" height="2" rx="0.5"/>\n</svg>\n'),this._registerButton("aiProofread","Proofread",'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n  <path fill="currentColor" d="M4 16l3-8h1l3 8h-1.2l-.7-2H5.9l-.7 2H4zm2.3-3.2h2.4L7.5 9.5l-1.2 3.3z"/>\n  <path fill="currentColor" d="M12.5 7l1.5 1.5 4-4-1.5-1.5-4 4z"/>\n  <path fill="currentColor" d="M11 8.5L12.5 7l1.5 1.5-1.5 1.5-1.5-1.5z"/>\n  <circle cx="15" cy="14" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/>\n  <path d="M17 16l2 2" stroke="currentColor" stroke-width="1.5" fill="none"/>\n</svg>\n'),this._registerWriteForMeButton()}destroy(){super.destroy(),this._formView.destroy()}_registerButton(e,r,i){const o=this.editor;o.ui.componentFactory.add(e,n=>{const l=o.commands.get(e),c=new t.ButtonView(n);return c.set({label:Drupal.t("AI @label",{"@label":r}),icon:i,tooltip:!0,withText:!1}),c.bind("isEnabled").to(l,"isEnabled"),this.listenTo(c,"execute",async()=>{s(c);try{await o.execute(e)}catch(t){console.error(`[BrowserAI UI] Error executing ${e}:`,t)}finally{a(c)}o.editing.view.focus()}),c})}_registerWriteForMeButton(){const e=this.editor;e.ui.componentFactory.add("aiWriteForMe",r=>{const i=e.commands.get("aiWriteForMe"),o=new t.ButtonView(r);return this._writeForMeButton=o,o.set({label:Drupal.t("AI Write for Me"),icon:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n  <path fill="currentColor" d="M10 2l2 3h-1.5v4h-1V5H8l2-3z"/>\n  <path d="M4 10h12v7H4v-7z" fill="none" stroke="currentColor" stroke-width="1.5"/>\n  <rect fill="currentColor" x="6" y="12" width="8" height="1.5" rx="0.25"/>\n  <rect fill="currentColor" x="6" y="14.5" width="5" height="1.5" rx="0.25"/>\n</svg>\n',tooltip:!0,withText:!1}),o.bind("isEnabled").to(i,"isEnabled"),this.listenTo(o,"execute",()=>{this._showForm()}),o})}_createFormView(){const e=this.editor,r=new n(e.locale);return this.listenTo(r,"submit",async()=>{const t=r.topicInputView.fieldView.element.value;if(t.trim()){s(r.submitButtonView),this._writeForMeButton&&s(this._writeForMeButton),r.cancelButtonView.isEnabled=!1;try{await e.execute("aiWriteForMe",{topic:t})}catch(e){console.error("[BrowserAI UI] Error executing command:",e)}finally{a(r.submitButtonView),this._writeForMeButton&&a(this._writeForMeButton),r.cancelButtonView.isEnabled=!0,this._hideForm()}}}),this.listenTo(r,"cancel",()=>{this._hideForm()}),(0,t.clickOutsideHandler)({emitter:r,activator:()=>this._balloon.visibleView===r,contextElements:[this._balloon.view.element],callback:()=>this._hideForm()}),r.keystrokes.set("Esc",(e,t)=>{this._hideForm(),t()}),r}_showForm(){this._balloon.hasView(this._formView)||(this._balloon.add({view:this._formView,position:this._getBalloonPositionData()}),this._formView.topicInputView.fieldView.element.focus())}_hideForm(){this._balloon.hasView(this._formView)&&(this._formView.topicInputView.fieldView.element.value="",this._balloon.remove(this._formView),this.editor.editing.view.focus())}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;return{target:e.domConverter.viewRangeToDom(t.selection.getFirstRange())}}}class c extends e.Command{constructor(e,t){super(e),this.operation=t,this.set("isProcessing",!1)}refresh(){const e=this.editor.model.document.selection,t="undefined"!=typeof window&&"Summarizer"in window&&"Proofreader"in window&&"Rewriter"in window&&"Writer"in window;if("writeForMe"===this.operation)return void(this.isEnabled=t&&!this.isProcessing);const r=e.getFirstRange(),i=r&&!r.isCollapsed;this.isEnabled=t&&i&&!this.isProcessing}async execute(e={}){if(this.isProcessing)return;const t=this.editor.model,r=t.document.selection;this.isProcessing=!0,this.refresh();try{let i;if("writeForMe"===this.operation){const t=e.topic||"";if(!t.trim())return;i=await async function(e){if(!window.Writer)throw new Error("Writer API is not available");const t=await window.Writer.create({format:"plain-text"});try{const r=`Write content about: ${e}. Give plain-text only. Don't use markdown.`;return await t.write(r)}finally{t.destroy()}}(t)}else{const e=this._getSelectedText();if(!e)return;switch(this.operation){case"rewrite":i=await async function(e){if(!window.Rewriter)throw new Error("Rewriter API is not available");const t=await window.Rewriter.create();try{return await t.rewrite(e,{})}finally{t.destroy()}}(e);break;case"summarize":i=await async function(e){if(!window.Summarizer)throw new Error("Summarizer API is not available");const t=await window.Summarizer.create({type:"tldr",format:"plain-text",length:"long"});try{return await t.summarize(e)}finally{t.destroy()}}(e);break;case"proofread":i=await async function(e){if(!window.Proofreader)throw new Error("Proofreader API is not available");const t=await window.Proofreader.create({expectedInputLanguages:["en"]});try{return(await t.proofread(e)).correctedInput}finally{t.destroy()}}(e);break;default:return}}i&&t.change(e=>{if("writeForMe"===this.operation){const t=r.getFirstPosition();e.insertText(i,t)}else{const o=r.getFirstRange();o&&t.insertContent(e.createText(i),o)}})}catch(e){console.error("[BrowserAI] Error:",e)}finally{this.isProcessing=!1,this.refresh()}}_getSelectedText(){const e=this.editor.model.document.selection.getFirstRange();if(!e||e.isCollapsed)return"";let t="";for(const r of e.getItems())(r.is("$text")||r.is("$textProxy"))&&(t+=r.data);return t}}class w extends e.Plugin{static get requires(){return[l]}static get pluginName(){return"BrowserAi"}init(){const e=this.editor;e.commands.add("aiRewrite",new c(e,"rewrite")),e.commands.add("aiSummarize",new c(e,"summarize")),e.commands.add("aiProofread",new c(e,"proofread")),e.commands.add("aiWriteForMe",new c(e,"writeForMe"))}}const d={BrowserAi:w}})(),i=i.default})());